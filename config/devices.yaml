# devices.yaml
# AWE Test Rig Hardware Configuration
# 
# This file contains all hardware-specific settings including:
# - NI cDAQ channel mappings and calibration
# - Serial port configurations  
# - Device communication settings
# - CALIBRATED ZERO OFFSETS for pressure/current sensors

# ✅ NI-DAQmx library available
# ✅ Pico TC-08 libraries available
# ✅ Window icon loaded: C:\Users\terra\Desktop\test_rig\assets\favicon.ico
# ✅ Dashboard window maximized
# 📁 Initializing session directories:
#    → Base data directory: C:\Users\terra\Desktop\test_rig\data
#    → Sessions directory: C:\Users\terra\Desktop\test_rig\data\sessions
#    → ✅ Directory structure ready
# 🔍 Loading configuration from: C:\Users\terra\Desktop\test_rig\config\devices.yaml
# ✅ Device configuration loaded from C:\Users\terra\Desktop\test_rig\config\devices.yaml
#    Calibration date: 2025-06-04
#    🔍 Loaded BGA units: ['bga_1', 'bga_2', 'bga_3']
#      bga_1 (COM8): H2/O2
#      bga_2 (COM3): O2/H2
#      bga_3 (COM9): O2/H2
# 🔌 Connect button clicked
# 🔌 Starting all hardware services...
#    → Starting NI cDAQ service...
# 🔌 Connecting to NI cDAQ...
#    → Connecting to NI-DAQmx hardware
#    → Scanning for cDAQ devices...
#      • Found: cDAQ9187-23E902C (cDAQ-9187)
#    → Configuring analog input channels:
#      • PT01: cDAQ9187-23E902CMod1/ai0 (4-20mA, calibrated 4.0-20.0mA)
#      • PT02: cDAQ9187-23E902CMod1/ai1 (4-20mA, calibrated 4.0-20.0mA)
#      • Current: cDAQ9187-23E902CMod1/ai2 (4-20mA, calibrated 4.0-20.0mA)
#      • PT03: cDAQ9187-23E902CMod1/ai3 (4-20mA, calibrated 4.0-20.0mA)
#      • PT04: cDAQ9187-23E902CMod1/ai4 (4-20mA, calibrated 4.0-20.0mA)
#      • PT05: cDAQ9187-23E902CMod1/ai5 (4-20mA, calibrated 4.0-20.0mA)
#      • Flowrate: cDAQ9187-23E902CMod1/ai6 (4-20mA, calibrated 4.0-20.0mA)
#      • PT06: cDAQ9187-23E902CMod1/ai7 (4-20mA, calibrated 4.0-20.0mA)
#    → Configuring digital output channels:
#      • KOH Storage: cDAQ9187-23E902CMod2/port0/line0
#      • DI Storage: cDAQ9187-23E902CMod2/port0/line1
#      • Stack Drain: cDAQ9187-23E902CMod2/port0/line2
#      • N2 Purge: cDAQ9187-23E902CMod2/port0/line3
#      • O2 Purge: cDAQ9187-23E902CMod2/port0/line5
#      • Pump: cDAQ9187-23E902CMod2/port0/line4
#      • KOH Pump: cDAQ9187-23E902CMod2/port0/line6
#    → Setting all outputs to safe state (OFF)
# ✅ Real NI cDAQ connected successfully
# 📊 Starting NI DAQ polling at 100 Hz...
# ✅ NI DAQ polling started
#    ✅ NI cDAQ connected - Pressure/Current sensors + Valve/Pump control
#    → Starting Pico TC-08 service...
# 🌡️  Connecting to Pico TC-08 thermocouple logger...
#    → Loading TC-08 DLL...
#    → TC-08 library loaded: C:\Program Files\Pico Technology\SDK\lib\usbtc08.dll
#    → DLL loaded successfully
#    → Connecting to hardware...
#    → TC-08 device opened with handle: 1
#    → Hardware connected (handle: 1)
#    → Configuring channels...
#    → Configured 8 K-type thermocouple channels
#    → Configured 8 thermocouple channels:
#      • CH0: TC01
#      • CH1: TC02
#      • CH2: TC03
#      • CH3: TC04
#      • CH4: TC05
#      • CH5: TC06
#      • CH6: TC07
#      • CH7: TC08
# ✅ Pico TC-08 connected successfully
# 🌡️  Starting Pico TC-08 polling at 1 Hz...
#    → TC-08 streaming started at 1Hz
# ✅ Pico TC-08 polling started
#    ✅ Pico TC-08 connected - 8-channel thermocouple logger
#    → Starting BGA244 analyzers...
# ⚗️  Connecting to BGA244 gas analyzers...
#    → Attempting hardware connection...
#    → Connecting BGAs to configured ports...
#    → Trying to connect BGA01 to COM8...
# 🔌 Connecting to BGA01 on COM8...
# ❌ No response from device on COM8
# ✅ Disconnected from COM8
#    ❌ BGA01 failed to connect to COM8
#    → Trying to connect BGA02 to COM3...
# 🔌 Connecting to BGA02 on COM3...
# ❌ No response from device on COM3
# ✅ Disconnected from COM3
#    ❌ BGA02 failed to connect to COM3
#    → Trying to connect BGA03 to COM9...
# 🔌 Connecting to BGA03 on COM9...
# ❌ Connection failed on COM9: could not open port 'COM9': FileNotFoundError(2, 'The system cannot find the file specified.', None, 2)
#    ❌ BGA03 failed to connect to COM9
# ⚠️  No BGA244 hardware detected
#    → All BGAs will show no data until connected
# ✅ BGA244 service ready (0 devices connected)
# ⚗️  Starting BGA244 polling at 0.2 Hz...
# ✅ BGA244 polling started
#    ✅ BGA244 connected - 3x gas analyzers (H2, O2, N2)
#    → Starting CVM-24P service...
#    → Loaded 5 module mappings from devices.yaml
#    → Physical connection order:
#       Module 1 - 158458 (0xA1)
#       Module 2 - 158436 (0xA6)
#       Module 3 - 158435 (0xA7)
#       Module 4 - 158453 (0xA4)
#       Module 5 - 158340 (0xA9)
# 🔋 Connecting to CVM-24P cell voltage monitor...
#    → Attempting hardware connection...
#    → Found 1 available ports: ['COM5']
#    → Trying port COM5 (1/1)...
# DEBUG: ===== Starting CVM24P connection debug session =====
#    → Connecting to COM5 at 1000000 baud...
#       → Bus connected
#       → Using ultra-fast initialization with cached addresses...
#       → ✅ Created module map for 5 cached modules - proceeding to initialization
#    → Initializing 5 modules...
#    → DEBUG: Initialization order: ['158458', '158436', '158435', '158453', '158340']
#    ✅ Module 158458 (0xA1) initialized
#    ✅ Module 158436 (0xA6) initialized
#    ✅ Module 158435 (0xA7) initialized
#    ✅ Module 158453 (0xA4) initialized
#    ✅ Module 158340 (0xA9) initialized
#    → DEBUG: Successfully initialized modules: ['158458', '158436', '158435', '158453', '158340']
#    → Success! 5/5 modules initialized via ultra-fast cached path (100.0% success rate)
# DEBUG: Voltage reading - module sorting and channel assignment (PHYSICAL ORDER):
#    → Success on COM5!
# DEBUG:   Module 158458 (0xA1) → Channels 1-24
# DEBUG:   Module 158436 (0xA6) → Channels 25-48
# DEBUG:   Module 158435 (0xA7) → Channels 49-72
# DEBUG:   Module 158453 (0xA4) → Channels 73-96
# DEBUG:   Module 158340 (0xA9) → Channels 97-120
# ✅ CVM-24P connected - Hardware mode with 5 modules
# 🔋 Starting CVM-24P polling at 10 Hz...
# ✅ CVM-24P polling started
#    ✅ CVM-24P connected - 24-channel cell voltage monitor
# ✅ All 4/4 services started successfully
#    ✅ All devices connected via ControllerManager
# Visible voltage channels: [0]
# Visible voltage channels: [0, 24]
# Visible voltage channels: [0, 24, 48]
# Visible voltage channels: [0, 24, 48, 72]
# Visible voltage channels: [0, 24, 48, 72, 96]
# Visible pressure channels: [0, 1, 2, 3, 4, 5]
# ▶️  Start Test button clicked
#    → Starting test sequence...
#    → Plots reset for new test
# 🧪 Starting new test session...
# 📁 New test session started: 2025-07-31_17-00-42_UI_Test_Session
#    → Session path: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session
#    → Start time: 2025-07-31 17:00:42
#    → Timer started from 0
#    → Configuration snapshot saved
#    → Starting CSV data logging...
# 📊 Starting CSV data logging...
#    → Session: 2025-07-31_17-00-42_UI_Test_Session
#    → Session folder: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session
#    → Absolute path: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session
#    → Initializing CSV files...
#       → Getting base filename from session manager...
#       → Base filename: 2025-07-31_17-00-42
#       → Creating 4 CSV files...
#          • Creating main_sensors: 2025-07-31_17-00-42_sensors.csv
#            → Full path: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session\csv_data\2025-07-31_17-00-42_sensors.csv
#            → Opening file for writing...
#            → Writing 18 column headers
#            → ✅ main_sensors file created successfully
#          • Creating gas_analysis: 2025-07-31_17-00-42_gas_analysis.csv
#            → Full path: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session\csv_data\2025-07-31_17-00-42_gas_analysis.csv
#            → Opening file for writing...
#            → Writing 9 column headers
#            → ✅ gas_analysis file created successfully
#          • Creating cell_voltages: 2025-07-31_17-00-42_cell_voltages.csv
#            → Full path: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session\csv_data\2025-07-31_17-00-42_cell_voltages.csv
#            → Opening file for writing...
#            → Writing 122 column headers
#            → ✅ cell_voltages file created successfully
#          • Creating actuator_states: 2025-07-31_17-00-42_actuators.csv
#            → Full path: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session\csv_data\2025-07-31_17-00-42_actuators.csv
#            → Opening file for writing...
#            → Writing 9 column headers
#            → ✅ actuator_states file created successfully
#       → ✅ All 4 CSV files initialized
# 📊 CSV logging worker started (interval: 1.0s)
# ✅ CSV logging started successfully
#    → Log interval: 1.0s
#    → Files created: 4
#       • main_sensors: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session\csv_data\2025-07-31_17-00-42_sensors.csv
#       • gas_analysis: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session\csv_data\2025-07-31_17-00-42_gas_analysis.csv
#       • cell_voltages: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session\csv_data\2025-07-31_17-00-42_cell_voltages.csv
#       • actuator_states: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session\csv_data\2025-07-31_17-00-42_actuators.csv
# ✅ Test session started: 2025-07-31_17-00-42_UI_Test_Session
#    → Session folder: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session
#    → Configuration saved: 2025-07-31_17-00-42.json
#    → Timer: ✅ Started
#    → CSV logging: ✅ Started - Files will be created
#    → Log files: sensors.csv, gas_analysis.csv, cell_voltages.csv, actuators.csv
#    ✅ Test started successfully with CSV data logging
#    → CSV files are being created in session folder
# ⏹️  Stop Test button clicked
#    → Stopping test sequence...
# 🧪 Stopping test session...
#    → Timer stopped and reset
# 📊 Stopping CSV data logging...
# 📊 CSV logging worker stopped
# ✅ CSV logging stopped
#    → Log entries: 300
#    → Duration: 05:01
# 📁 Active channels saved to session metadata:
#    → pressure: [0, 1, 2, 3, 4, 5]
#    → gas: [0, 1, 2]
#    → temperature: [0, 1, 2, 3, 4, 5, 6, 7]
#    → voltage: [0, 24, 48, 72, 96]
#    → current: [0]
# 📁 Session ended: 2025-07-31_17-00-42_UI_Test_Session
#    → Duration: 0:05:02
#    → Status: completed
#    → Files created: 5
#    → Starting post-processing...
# 🔄 Starting post-processing for session: 2025-07-31_17-00-42_UI_Test_Session
# 📊 Loading CSV data from C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session\csv_data
#    → Loading sensors: 2025-07-31_17-00-42_sensors.csv
#    ✅ Loaded 300 rows from sensors
#    → Loading gas_analysis: 2025-07-31_17-00-42_gas_analysis.csv
#    ✅ Loaded 300 rows from gas_analysis
#    → Loading cell_voltages: 2025-07-31_17-00-42_cell_voltages.csv
#    ✅ Loaded 300 rows from cell_voltages
#    → Loading actuators: 2025-07-31_17-00-42_actuators.csv
#    ✅ Loaded 300 rows from actuators
# ✅ Data loaded successfully, max time: 301.2s
# 📊 Generating pressure plot...
# ✅ Pressure plot saved: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session\plots\pressure.jpg
# 📊 Generating gas purity plot...
# ✅ Gas purity plot saved: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session\plots\gas_purity.jpg
# 📊 Generating temperature plot...
# ✅ Temperature plot saved: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session\plots\temperature.jpg
# 📊 Generating cell voltage plot...
# ✅ Cell voltage plot saved: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session\plots\cell_voltage.jpg
# 📊 Generating current plot...
# ✅ Current plot saved: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session\plots\current.jpg
# 📊 Generating flowrate plot...
# ✅ Flowrate plot saved: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session\plots\flowrate.jpg
# ✅ Post-processing complete: 6/6 plots generated
#    → Plots saved to: C:\Users\terra\Desktop\test_rig\data\sessions\2025-07-31_17-00-42_UI_Test_Session\plots
#    ✅ Post-processing completed - plots generated
# ✅ Test session stopped
#    → Final status: completed
#    → Duration: 0:05:02
#    → Files created: 5
#    → Data logged: 300 entries
#    ✅ Test stopped - CSV data logging completed
#    → 5 files saved in session folder

# NI cDAQ Configuration
ni_cdaq:
  chassis: "cDAQ9187-23E902C"
  
  # NI-9253 Analog Input Module (4-20mA Current Inputs)
  analog_inputs:
    module: "cDAQ9187-23E902CMod1"
    sample_rate: 100  # Hz
    
    # 4-20mA Signal Conditioning
    current_range:
      min_ma: 4.0   # Calibrated minimum - 4mA = 0 PSI/A (updated from 3.95)
      max_ma: 20.0  # Standard maximum
      fault_threshold_low: 3.5   # Below this = DISCONNECTED
      fault_threshold_high: 20.5 # Above this = OVERRANGE
    
    # Individual Sensor Channels with Calibrated Zero Offsets
    channels:
      pt01:
        channel: "ai0"
        name: "PT01"
        units: "PSI"
        range: [0, 15]
        # CALIBRATED ZERO OFFSET - Corrects sensor bias at 0 PSI
        zero_offset: -0.035  # Corrects +0.035 PSI bias to achieve true 0 PSI
        description: "Hydrogen side pressure measurement"
        
      pt02:
        channel: "ai1" 
        name: "PT02"
        units: "PSI"
        range: [0, 15]
        # CALIBRATED ZERO OFFSET - Corrects sensor bias at 0 PSI  
        zero_offset: -0.066  # Corrects +0.066 PSI bias to achieve true 0 PSI
        description: "Oxygen side pressure measurement"
        
      current:
        channel: "ai2"
        name: "Current"
        units: "A"
        range: [0, 150]
        # CALIBRATED ZERO OFFSET - 4mA represents true 0 A
        zero_offset: 0.0  # No bias correction needed for current sensor
        description: "Electrolyzer stack current measurement"
        
      pt03:
        channel: "ai3"
        name: "PT03"
        units: "PSI"
        range: [0, 1.012]  # 0-28 inWC converted to PSI (28 * 0.036127 = 1.012)
        zero_offset: 0.0
        description: "Pressure transducer 01 (4-20mA)"
        
      pt04:
        channel: "ai4"
        name: "PT04"  
        units: "PSI"
        range: [0, 1.012]  # 0-28 inWC converted to PSI
        zero_offset: 0.0
        description: "Pressure transducer 02 (4-20mA)"
        
      pt05:
        channel: "ai5"
        name: "PT05"
        units: "PSI"
        range: [0, 1.012]  # 0-28 inWC converted to PSI
        zero_offset: 0.0
        description: "Pressure transducer 03 (4-20mA)"
        
      flowrate:
        channel: "ai6"
        name: "Flowrate"
        units: "SLM"
        range: [0, 250]  # 0-250 SLM (Standard Liters per Minute)
        zero_offset: 0.0
        description: "Gas flowrate measurement"
        
      pt06:
        channel: "ai7"
        name: "PT06"
        units: "PSI"
        range: [0, 1.012]  # 0-28 inWC converted to PSI
        zero_offset: 0.0
        description: "Pressure transducer 05 (4-20mA)"
  
  # NI-9485 Digital Output Modules (Relay Control)
  digital_outputs:
    module_2: "cDAQ9187-23E902CMod2"
    module_3: "cDAQ9187-23E902CMod3"
    
    # Valve and Pump Control Mapping
    valves:
      koh_storage:
        module: "cDAQ9187-23E902CMod2"
        line: 0
        name: "KOH Storage Valve"
        description: "Controls KOH electrolyte storage tank valve"
        
      di_storage:
        module: "cDAQ9187-23E902CMod2"
        line: 1
        name: "DI Storage Valve"
        description: "Controls deionized water storage tank valve"
        
      stack_drain:
        module: "cDAQ9187-23E902CMod2" 
        line: 2
        name: "Stack Drain Valve"
        description: "Controls electrolyzer stack drain valve"
        
      h2_purge:
        module: "cDAQ9187-23E902CMod2"
        line: 3
        name: "H2 Purge Valve"
        description: "Controls hydrogen purge valve for system cleanup"
        
      o2_purge:
        module: "cDAQ9187-23E902CMod2"
        line: 5
        name: "O2 Purge Valve"
        description: "Controls oxygen purge valve for system cleanup"
        
    pump:
      di_fill_pump:
        module: "cDAQ9187-23E902CMod2"
        line: 4
        name: "DI Fill Pump"
        description: "Controls deionized water fill pump"
        
      koh_fill_pump:
        module: "cDAQ9187-23E902CMod2"
        line: 6
        name: "KOH Fill Pump"
        description: "Controls KOH electrolyte fill pump"

# Pico TC-08 Thermocouple Logger
pico_tc08:
  device_type: "Pico TC-08"
  connection: "USB"
  
  # Temperature Channels - NO ZERO OFFSETS (raw thermocouple readings)
  channels:
    channel_0:
      name: "TC01"
      type: "K"  # Thermocouple type
      units: "°C"
      range: [0, 100]
      # NO ZERO OFFSET - Temperature sensors read direct thermocouple values
      description: "Thermocouple 1 temperature sensor"
      
    channel_1:
      name: "TC02"
      type: "K"
      units: "°C" 
      range: [0, 100]
      # NO ZERO OFFSET - Temperature sensors read direct thermocouple values
      description: "Thermocouple 2 temperature sensor"
      
    channel_2:
      name: "TC03"
      type: "K"
      units: "°C"
      range: [0, 100] 
      # NO ZERO OFFSET - Temperature sensors read direct thermocouple values
      description: "Thermocouple 3 temperature sensor"
      
    channel_3:
      name: "TC04"
      type: "K"
      units: "°C"
      range: [0, 100]
      # NO ZERO OFFSET - Temperature sensors read direct thermocouple values
      description: "Thermocouple 4 temperature sensor"
      
    channel_4:
      name: "TC05"
      type: "K"
      units: "°C"
      range: [0, 100]
      # NO ZERO OFFSET - Temperature sensors read direct thermocouple values
      description: "Thermocouple 5 temperature sensor"
      
    channel_5:
      name: "TC06"
      type: "K"
      units: "°C"
      range: [0, 100]
      # NO ZERO OFFSET - Temperature sensors read direct thermocouple values
      description: "Thermocouple 6 temperature sensor"
      
    channel_6:
      name: "TC07"
      type: "K"
      units: "°C"
      range: [0, 100]
      # NO ZERO OFFSET - Temperature sensors read direct thermocouple values
      description: "Thermocouple 7 temperature sensor"
      
    channel_7:
      name: "TC08"
      type: "K"
      units: "°C"
      range: [0, 100]
      # NO ZERO OFFSET - Temperature sensors read direct thermocouple values
      description: "Thermocouple 8 temperature sensor"

# BGA244 Gas Analyzers (3 units)
bga244:
  communication:
    protocol: "RS-422"
    interface: "USB-to-RS422"
    baud_rate: 9600
    data_bits: 8
    stop_bits: 1
    parity: "None"
    timeout: 2.0  # seconds
  
  # Three BGA244 Units (Windows COM ports)
  units:
    bga_1:
      port: "COM8"
      name: "BGA01"
      gas_types: ["H2", "O2", "N2"]
      description: "Gas analyzer on hydrogen header"
      # Gas analysis configuration for normal operation
      normal_mode:
        primary_gas: "H2"     # H2 in O2 mixture
        secondary_gas: "O2"   # H2 in O2 mixture
        remaining_gas: "N2"   # Remaining gas (calculated)
        expected_gases: ["H2", "O2", "N2"]
      # Gas analysis configuration for purge operation
      purge_mode:
        primary_gas: "H2"     # H2 in N2 during purge
        secondary_gas: "N2"   # N2 purge gas
        remaining_gas: "O2"   # Remaining gas (calculated)
        expected_gases: ["H2", "N2", "O2"]
      
    bga_2:
      port: "COM3"
      name: "BGA02"
      gas_types: ["O2", "H2", "N2"]
      description: "Gas analyzer on oxygen header"
      # Gas analysis configuration for normal operation
      normal_mode:
        primary_gas: "O2"     # O2 in H2 mixture
        secondary_gas: "H2"   # O2 in H2 mixture
        remaining_gas: "N2"   # Remaining gas (calculated)
        expected_gases: ["O2", "H2", "N2"]
      # Gas analysis configuration for purge operation
      purge_mode:
        primary_gas: "O2"     # O2 in N2 during purge
        secondary_gas: "N2"   # N2 purge gas
        remaining_gas: "H2"   # Remaining gas (calculated)
        expected_gases: ["O2", "N2", "H2"]
      
    bga_3:
      port: "COM9"
      name: "BGA03"
      gas_types: ["H2", "O2", "N2"]
      description: "Gas analyzer on de-oxo unit"
      # Gas analysis configuration for normal operation
      normal_mode:
        primary_gas: "O2"     # H2 in O2 mixture
        secondary_gas: "H2"   # H2 in O2 mixture
        remaining_gas: "N2"   # Remaining gas (calculated)
        expected_gases: ["O2", "H2", "N2"]
      # Gas analysis configuration for purge operation
      purge_mode:
        primary_gas: "O2"     # H2 in N2 during purge
        secondary_gas: "N2"   # N2 purge gas
        remaining_gas: "H2"   # Remaining gas (calculated)
        expected_gases: ["O2", "N2", "H2"]

# CVM-24P Cell Voltage Monitor
cvm24p:
  device_type: "CVM-24P"
  connection: "USB"
  protocol: "XC2"
  
  # Physical Module Mapping
  modules:
    # Module 1: Physical position 1
    '158458':
      address: 0xA1
      name: "Module 1"
      channels: [1, 24]  # Channels 1-24
      description: "CVM24P Module 1 - First physical module"
    
    # Module 2: Physical position 2  
    '158436':
      address: 0xA6
      name: "Module 2"
      channels: [25, 48]  # Channels 25-48
      description: "CVM24P Module 2 - Second physical module"
    
    # Module 3: Physical position 3
    '158435':
      address: 0xA7
      name: "Module 3"
      channels: [49, 72]  # Channels 49-72
      description: "CVM24P Module 3 - Third physical module"
    
    # Module 4: Physical position 4
    '158453':
      address: 0xA4
      name: "Module 4"
      channels: [73, 96]  # Channels 73-96
      description: "CVM24P Module 4 - Fourth physical module"
    
    # Module 5: Physical position 5
    '158340':
      address: 0xA9
      name: "Module 5"
      channels: [97, 120]  # Channels 97-120
      description: "CVM24P Module 5 - Fifth physical module"
  
  # Cell Voltage Configuration
  cells:
    total_cells: 120
    groups: 6  # Group into 6 groups of 20 cells each
    voltage_range: [0, 5]  # Volts
      
  communication:
    baud_rate: 1000000  # 1MHz - XC2 protocol standard
    data_bits: 8
    stop_bits: 1
    parity: "None"
    timeout: 1.0

# System-Wide Configuration
system:
  # Data Acquisition Rates
  sample_rates:
    ni_daq: 100      # Hz - NI cDAQ analog inputs
    pico_tc08: 1     # Hz - Temperature readings
    bga244: 0.2      # Hz - Gas analyzer readings (every 5 seconds)
    cvm24p: 10       # Hz - Cell voltage readings
  
  # Calibration Settings
  calibration:
    auto_zero_on_startup: true  # Automatically apply zero offsets on connection
    allow_runtime_adjustment: false  # Prevent accidental calibration changes during tests
    calibration_date: "2025-06-04"   # Updated calibration date
    calibration_technician: "Engineering Team"
    
    # Zero Offset Application Rules
    zero_offset_rules:
      temperature_sensors: "Apply at ambient conditions (20-25°C)"
      pressure_sensors: "Apply at atmospheric pressure (0 psig) with sensors vented to atmosphere"
      current_sensor: "Apply with no load current (0 A)"
      gas_analyzers: "Apply in nitrogen purge environment"
      voltage_sensors: "Apply with stack at rest potential"
    
    # Calibration Notes (2025-06-04)
    calibration_notes:
      current_range_update: "Changed minimum current from 3.95mA to 4.0mA for standard 4-20mA scaling"
      pressure_sensor_1: "Zero offset -0.035 PSI applied to correct +0.035 PSI bias at 0 PSI"
      pressure_sensor_2: "Zero offset -0.066 PSI applied to correct +0.066 PSI bias at 0 PSI"
      calibration_method: "Sensors vented to atmosphere (0 psig) for zero point calibration"

 